<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle to Elasticsearch Mapping Generator</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/all.min.css" rel="stylesheet">

    <style>

        .indices-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .environment-selector {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .environment-selector:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(13, 110, 253, 0.1);
        }

        .index-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .index-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(13, 110, 253, 0.15);
        }

        .index-card.selected {
            border-color: var(--success-color);
            background: linear-gradient(135deg, #d1e7dd 0%, #a3cfbb 100%);
        }

        .index-health {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .health-green { background-color: #28a745; }
        .health-yellow { background-color: #ffc107; }
        .health-red { background-color: #dc3545; }

        .mapping-viewer {
            background: #2d3748;
            color: #ffffff;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            border-radius: 8px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
            position: relative;
        }

        .settings-panel {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .settings-category {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
        }

        .settings-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }

        .settings-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(13, 110, 253, 0.1);
        }

        .field-type-badge {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .badge-text { background: #e3f2fd; color: #1976d2; }
        .badge-keyword { background: #f3e5f5; color: #7b1fa2; }
        .badge-long { background: #e8f5e8; color: #388e3c; }
        .badge-date { background: #fff3e0; color: #f57c00; }
        .badge-boolean { background: #fce4ec; color: #c2185b; }
        .badge-nested { background: #e1f5fe; color: #0288d1; }
        .badge-object { background: #f1f8e9; color: #689f38; }

        .action-toolbar {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .deep-dive-container {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            border-radius: 12px;
            padding: 20px;
            color: white;
        }

        .breadcrumb-nav {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 8px 16px;
            margin-bottom: 20px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-connected {
            background-color: #d1e7dd;
            color: #0a3622;
            border: 1px solid #a3cfbb;
        }

        .status-disconnected {
            background-color: #f8d7da;
            color: #58151c;
            border: 1px solid #f1aeb5;
        }

        .status-connecting {
            background-color: #fff3cd;
            color: #664d03;
            border: 1px solid #ffecb5;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .workflow-step {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .workflow-step.active {
            border-color: #0d6efd;
            background: linear-gradient(135deg, #e7f3ff 0%, #d4e7ff 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(13, 110, 253, 0.15);
        }

        .workflow-step.completed {
            border-color: #198754;
            background: linear-gradient(135deg, #d1e7dd 0%, #a3cfbb 100%);
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #6c757d;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            transition: all 0.3s ease;
        }

        .workflow-step.active .step-number {
            background: #0d6efd;
            transform: scale(1.1);
        }

        .workflow-step.completed .step-number {
            background: #198754;
        }

        /* Multi-select table styling */
        .multi-select-table {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
        }

        .table-item {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .table-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .table-item.selected {
            background: linear-gradient(135deg, #0d6efd 0%, #6610f2 100%);
            color: white;
            border-left: 5px solid #fff;
        }

        .table-checkbox {
            margin-right: 10px;
            transform: scale(1.2);
        }

        /* Progress indicator */
        .progress-indicator {
            background: white;
            border-radius: 50px;
            padding: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .progress-step {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 25px;
            margin: 0 5px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .progress-step.active {
            background: #0d6efd;
            color: white;
        }

        .progress-step.completed {
            background: #198754;
            color: white;
        }

        /* Relationship builder */
        .relationship-builder {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            min-height: 300px;
        }

        .relationship-item {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .auto-detection-panel {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #198754;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .sql-editor {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #2d3748;
            color: #ffffff;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
        }

        .bulk-action-bar {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .oracle-field, .elastic-field {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .oracle-field {
            border-left: 4px solid #dc3545;
        }

        .elastic-field {
            border-left: 4px solid #0d6efd;
        }

        /* Relationship type selector */
        .relationship-type-option {
            display: inline-block;
            margin: 5px;
            padding: 8px 15px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .relationship-type-option:hover {
            border-color: #0d6efd;
            background: #e7f3ff;
        }

        .relationship-type-option.selected {
            background: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }

        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }


        .environment-card {
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
        }
        .environment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .connection-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-pending { background-color: #ffc107; }

        .mapping-builder {
            min-height: 400px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
        }

        .field-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: move;
        }

        .field-item.dragging {
            opacity: 0.5;
        }

        .nested-field {
            margin-left: 20px;
            border-left: 3px solid #007bff;
        }

        .query-editor {
            font-family: 'Courier New', monospace;
            background: #2d3748;
            color: #ffffff;
            border: none;
            padding: 15px;
            border-radius: 6px;
        }

        .results-table {
            max-height: 400px;
            overflow-y: auto;
        }

        .mapping-preview {
            background: #2d3748;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 6px;
            max-height: 500px;
            overflow-y: auto;
        }

        /* Sortable styles */
        .sortable-ghost {
            opacity: 0.4;
            background: #e9ecef;
        }

        .sortable-chosen {
            background: #fff3cd;
        }

        .sortable-drag {
            opacity: 0.8;
        }

        .column-item {
            cursor: grab;
        }

        .column-item:active {
            cursor: grabbing;
        }

        .column-entry {
            transition: all 0.2s ease;
        }

        .column-entry:hover {
            background-color: #e9ecef !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .add-column-btn {
            transition: all 0.2s ease;
        }

        .add-column-btn:hover {
            transform: scale(1.1);
        }

        .column-checkbox:checked + label {
            font-weight: bold;
        }

        .tab-content {
            padding: 20px 0;
        }

        .loading-spinner {
            display: none;
        }

        .loading-spinner.show {
            display: inline-block;
        }

        .nested-drop-zone {
            border: 2px dashed #28a745 !important;
            transition: all 0.3s ease;
        }

        .nested-drop-zone.drag-over {
            background-color: #d4edda;
            border-color: #155724 !important;
        }

        .draggable-field {
            cursor: move;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 8px;
            margin: 4px 0;
        }

        .checkbox-enhanced-container {
            margin-bottom: 20px;
        }

        .checkbox-values-display {
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .checkbox-values-display:focus {
            background-color: #fff;
            border-color: #0d6efd;
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
        }

        .checkbox-operator-icon {
            position: relative;
            border-color: #e9ecef;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .checkbox-operator-icon:hover {
            background-color: #0d6efd;
            border-color: #0d6efd;
            color: white;
            transform: scale(1.05);
        }

        .operator-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 50%;
            z-index: 10;
        }

        /* Field Configuration Items */
        .field-config-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .field-config-item:hover {
            border-color: #0d6efd;
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.15);
            transform: translateY(-2px);
        }

        /* Source Configuration Section */
        .source-config-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.3s ease;
        }

        .source-config-section:hover {
            border-color: #0d6efd;
            background: linear-gradient(135deg, #e7f3ff 0%, #d4e7ff 100%);
        }

        /* Mapping Fields List */
        .mapping-field-list {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 10px;
            background: white;
        }

        .mapping-field-item {
            padding: 12px;
            margin: 6px 0;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mapping-field-item:hover {
            background: #e3f2fd;
            border-color: #2196f3;
            transform: translateX(5px);
        }

        .mapping-field-item.selected {
            background: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }

        /* Enhanced Multi-Value Modal Styles */
        .values-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            max-height: 350px;
            overflow-y: auto;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }

        .value-checkbox-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.2s ease;
        }

        .value-checkbox-item:hover {
            border-color: #0d6efd;
            box-shadow: 0 2px 8px rgba(13, 110, 253, 0.15);
            transform: translateY(-1px);
        }

        /* Operator Button Group */
        #operatorButtonGroup .btn {
            padding: 15px;
            border-radius: 12px;
            margin: 0 5px;
            transition: all 0.3s ease;
        }

        #operatorButtonGroup .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        #operatorButtonGroup .btn-check:checked + .btn {
            transform: scale(1.05);
        }

        /* Selection Summary */
        .selection-summary {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }

        /* Selection Counter */
        #selectionCounter {
            font-size: 1rem;
            padding: 8px 16px;
            border-radius: 20px;
            background: linear-gradient(135deg, #0d6efd 0%, #6610f2 100%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .draggable-field:hover {
            background: #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nested-field-item {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
        }

        .field-type-badge {
            font-size: 0.75em;
            padding: 2px 6px;
            border-radius: 10px;
        }

        /* Enhanced Preview Styles */
        .mapping-preview-container {
            position: relative;
        }

        .oracle-preview .mapping-preview {
            background: linear-gradient(135deg, #ffe6e6 0%, #3a3535 100%);
            border-color: #dc3545;
        }

        .preview-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .field-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.25rem 0;
            border-bottom: 1px solid #e9ecef;
        }

        .field-summary-item:last-child {
            border-bottom: none;
        }

        .validation-item {
            display: flex;
            align-items: center;
            padding: 0.25rem 0;
        }

        .validation-item i {
            width: 1rem;
            margin-right: 0.5rem;
        }

        /* Visual Mapping Styles */
        .visual-mapping-container {
            min-height: 400px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
        }

        .field-tree {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
        }

        .field-tree-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            margin: 0.25rem 0;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
        }

        .field-tree-item:hover {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .field-tree-icon {
            width: 1.5rem;
            height: 1.5rem;
            margin-right: 0.75rem;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .field-type-text .field-tree-icon { background: #e3f2fd; color: #1976d2; }
        .field-type-keyword .field-tree-icon { background: #f3e5f5; color: #7b1fa2; }
        .field-type-long .field-tree-icon { background: #e8f5e8; color: #388e3c; }
        .field-type-integer .field-tree-icon { background: #e8f5e8; color: #388e3c; }
        .field-type-double .field-tree-icon { background: #e8f5e8; color: #388e3c; }
        .field-type-float .field-tree-icon { background: #e8f5e8; color: #388e3c; }
        .field-type-date .field-tree-icon { background: #fff3e0; color: #f57c00; }
        .field-type-boolean .field-tree-icon { background: #fce4ec; color: #c2185b; }
        .field-type-nested .field-tree-icon { background: #e1f5fe; color: #0288d1; }
        .field-type-object .field-tree-icon { background: #f1f8e9; color: #689f38; }
        .field-type-join .field-tree-icon { background: #fff8e1; color: #ff8f00; }

        .field-tree-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .field-tree-type {
            margin-left: auto;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .nested-field-container {
            margin-left: 2rem;
            border-left: 2px solid #dee2e6;
            padding-left: 1rem;
        }

        .field-tree-root {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }

        .field-tree-root .field-tree-icon {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* Enhanced Field Builder Styles */
        .field-builder-section {
            min-height: 200px;
            border: 2px dashed #dee2e6;
            border-radius: 0.5rem;
            padding: 1rem;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .field-builder-section.drag-over {
            border-color: #007bff;
            background: #e3f2fd;
        }

        .field-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            padding: 0.75rem;
            margin: 0.5rem 0;
            cursor: move;
            transition: all 0.2s ease;
        }

        .field-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .field-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .nested-field-section {
            background: #f1f3f4;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            padding: 0.5rem;
            margin-top: 0.5rem;
            min-height: 60px;
        }

        .parent-child-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 0.25rem;
            padding: 0.5rem;
            margin-top: 0.5rem;
            min-height: 60px;
        }

        .field-type-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }

        .btn-outline-purple {
            color: #6f42c1;
            border-color: #6f42c1;
        }

        .btn-outline-purple:hover {
            background-color: #6f42c1;
            border-color: #6f42c1;
            color: white;
        }

        .btn-outline-cyan {
            color: #17a2b8;
            border-color: #17a2b8;
        }

        .btn-outline-cyan:hover {
            background-color: #17a2b8;
            border-color: #17a2b8;
            color: white;
        }

        .drag-handle {
            cursor: grab;
            color: #6c757d;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .section-header {
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #dee2e6;
        }



        /* Enhanced Checkbox Container Styling */
        .checkbox-enhanced-container {
            margin-bottom: 20px;
        }

        .checkbox-values-display {
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .checkbox-values-display:focus {
            background-color: #fff;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .input-group .btn-outline-secondary {
            border-color: #e9ecef;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .input-group .btn-outline-secondary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        /* Multi-Value Modal Styling */
        .modal-lg {
            max-width: 800px;
        }

        #multiValueOptions {
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        #multiValueOptions .form-check {
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        #multiValueOptions .form-check:hover {
            background-color: rgba(99, 102, 241, 0.1);
        }

        #multiValueOptions .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        #multiValueCounter {
            font-size: 0.9rem;
            padding: 6px 12px;
        }

        .multi-value-checkbox {
            margin-right: 8px;
        }

        .btn-outline-primary:hover,
        .btn-outline-secondary:hover,
        .btn-outline-warning:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }


        .field-config-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .field-config-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .checkbox-field-display {
            position: relative;
        }

        .checkbox-operator-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #6c757d;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .checkbox-operator-icon:hover {
            color: #007bff;
            transform: translateY(-50%) scale(1.2);
        }

        .operator-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 10px;
            padding: 2px 6px;
        }

        .operator-AND { background-color: #28a745; }
        .operator-OR { background-color: #ffc107; color: #000; }
        .operator-NOT { background-color: #dc3545; }

        .source-config-section {
            background: #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }

        .mapping-field-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            background: white;
        }

        .mapping-field-item {
            padding: 8px;
            margin: 4px 0;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mapping-field-item:hover {
            background: #e9ecef;
        }

        .mapping-field-item.selected {
            background: #007bff;
            color: white;
        }

        .field-type-badge {
            font-size: 0.75em;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .preview-section {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .form-preview-container {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
        }

        .operator-selection-modal .operator-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .operator-selection-modal .operator-card:hover {
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0,123,255,0.2);
        }

        .operator-selection-modal .operator-card.selected {
            border-color: #007bff;
            background: #f8f9ff;
        }

        .values-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: #f8f9fa;
        }

        .value-checkbox-item {
            background: white;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            transition: all 0.2s ease;
        }

        .value-checkbox-item:hover {
            border-color: #007bff;
        }

        .selection-summary {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
        }

    </style>
</head>
<body>
<div class="container-fluid">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas  me-2"></i>
                 Elasticsearch Dynamic Mapping Generator &  UI Builder &  Query Builder
            </a>
        </div>
    </nav>

    <!-- Main Navigation Tabs -->
    <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="environments-tab" data-bs-toggle="tab" data-bs-target="#environments" type="button" role="tab">
                <i class="fas fa-server me-2"></i>Environments
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="mapping-tab" data-bs-toggle="tab" data-bs-target="#mapping" type="button" role="tab">
                <i class="fas fa-project-diagram me-2"></i>Mapping Builder
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="oracle-env-connection-tab" data-bs-toggle="tab" data-bs-target="#oracle-env-connection" type="button" role="tab">
                <i class="fas fa-network-wired me-2 text-danger"></i>Advance Mapping Builder
            </button>
        </li>


        <li class="nav-item" role="presentation">
            <button class="nav-link" id="enhanced-indices-tab" data-bs-toggle="tab" data-bs-target="#enhanced-indices" type="button" role="tab">
                <i class="fas fa-layer-group me-2 text-success"></i>Settings & Indices Manager
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="ui-field-mapping-tab" data-bs-toggle="tab" data-bs-target="#ui-field-mapping" type="button" role="tab">
                <i class="fas fa-wpforms me-2"></i>UI Field Mapping Builder
            </button>
        </li>

        <li class="nav-item" role="presentation">
            <button class="nav-link" id="mappings-list-tab" data-bs-toggle="tab" data-bs-target="#mappings-list" type="button" role="tab">
                <i class="fas fa-list me-2"></i>Saved Mappings
            </button>
        </li>


    </ul>



    <div class="tab-content" id="mainTabContent">
        <!-- Environments Tab -->
        <!-- Add this to the tab content sections -->
        <!-- REPLACE EXISTING UI-FIELD-MAPPING TAB CONTENT WITH THIS -->
        <!-- Line 500-600: Enhanced UI Field Mapping Builder Tab -->
        <div class="tab-pane fade" id="ui-field-mapping" role="tabpanel">



                <!-- Main Content -->
                <div class="row">
                    <!-- Form Builder Panel -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h6><i class="fas fa-wpforms me-2"></i>Dynamic Form Builder</h6>
                            </div>
                            <div class="card-body">
                                <!-- Environment Selection -->
                                <div class="mb-3">
                                    <label for="formEnvironment" class="form-label">Select Environment</label>
                                    <select id="formEnvironment" class="form-select">
                                        <option value="">Select Environment...</option>
                                    </select>
                                </div>

                                <!-- Index Selection -->
                                <div class="mb-3">
                                    <label for="formIndex" class="form-label">Select Index</label>
                                    <select id="formIndex" class="form-select" disabled>
                                        <option value="">Select Index...</option>
                                    </select>
                                </div>

                                <!-- Load Fields Button -->
                                <button id="loadIndexFields" class="btn btn-success w-100 mb-3" disabled>
                                    <i class="fas fa-download me-2"></i>Load Index Fields
                                </button>

                                <!-- Form Configuration -->
                                <div id="formConfigSection" style="display: none;">
                                    <div class="mb-3">
                                        <label for="formName" class="form-label">Form Name</label>
                                        <input type="text" class="form-control" id="formName" placeholder="Enter form name">
                                    </div>
                                    <div class="mb-3">
                                        <label for="formUrl" class="form-label">Form Access URL</label>
                                        <input type="text" class="form-control" id="formUrl" placeholder="Enter form URL path">
                                    </div>
                                    <button id="saveFormConfig" class="btn btn-primary w-100">
                                        <i class="fas fa-save me-2"></i>Save Form Configuration
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Saved Forms List -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h6><i class="fas fa-list me-2"></i>Saved Forms</h6>
                            </div>
                            <div class="card-body">
                                <div id="savedFormsList">
                                    <p class="text-muted text-center">No saved forms yet</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Field Configuration Panel -->
                    <!-- Enhanced Field Configuration Panel with Logical Operators -->
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-cogs me-2"></i>Enhanced Field Configuration with Logical Operators</h6>
                            </div>
                            <div class="card-body">
                                <div id="fieldConfigPanel" style="display: none;">
                                    <div class="row mb-3">
                                        <div class="col-md-5">
                                            <h6>Available Fields</h6>
                                            <div id="availableFields" class="border rounded p-3" style="height: 300px; overflow-y: auto;">
                                                <p class="text-muted">Select an index to view fields</p>
                                            </div>
                                        </div>

                                        <div class="col-md-7">
                                            <h6>Form Fields with Logical Operators</h6>
                                            <div id="formFieldsContainer" class="border rounded p-3" style="height: 300px; overflow-y: auto;">
                                                <div id="logicalFieldsBuilder">
                                                    <p class="text-muted">Configure fields to build your search form</p>
                                                </div>
                                            </div>

                                            <!-- Logical Operator Controls -->
                                            <div class="mt-3">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label class="form-label">Add Logical Operator</label>
                                                        <select id="logicalOperatorSelect" class="form-select">
                                                            <option value="AND">AND - All conditions must match</option>
                                                            <option value="OR">OR - Any condition can match</option>
                                                            <option value="NOT">NOT - Exclude condition</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">&nbsp;</label>
                                                        <button id="addLogicalOperator" class="btn btn-success w-100" disabled>
                                                            <i class="fas fa-plus me-2"></i>Add Operator Between Fields
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Query Structure Preview -->
                                            <div class="mt-3">
                                                <label class="form-label">Search Logic Preview</label>
                                                <div id="queryStructurePreview" class="alert alert-info">
                                                    <i class="fas fa-info-circle me-2"></i>No fields configured yet
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Form Preview with Logical Operators -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h6><i class="fas fa-eye me-2"></i>Form Preview with Search Logic</h6>
                            </div>
                            <div class="card-body">
                                <div id="formPreview">
                                    <p class="text-muted">Configure fields to see form preview</p>
                                </div>

                                <!-- Search Logic Visualization -->
                                <div class="mt-3">
                                    <h6>Search Logic Flow</h6>
                                    <div id="searchLogicFlow" class="p-3 bg-light rounded">
                                        <p class="text-muted text-center">Add fields and operators to visualize search logic</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

        </div>
        <div class="tab-pane fade show active" id="environments" role="tabpanel">
            <div class="row">
                <div class="col-md-6">
                    <!-- Oracle Environment Form -->
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h5><i class="fas fa-database me-2"></i>Add Oracle Environment</h5>
                        </div>
                        <div class="card-body">
                            <form id="oracleEnvironmentForm">
                                <div class="mb-3">
                                    <label for="oracleEnvName" class="form-label">Environment Name</label>
                                    <input type="text" class="form-control" id="oracleEnvName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="oracleEnvUrl" class="form-label">Oracle Connection String</label>
                                    <input type="text" class="form-control" id="oracleEnvUrl" placeholder="host:port/service_name" required>
                                    <div class="form-text">Format: hostname:port/service_name or TNS name</div>
                                </div>
                                <div class="mb-3">
                                    <label for="oracleEnvUsername" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="oracleEnvUsername" required>
                                </div>
                                <div class="mb-3">
                                    <label for="oracleEnvPassword" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="oracleEnvPassword" required>
                                </div>
                                <button type="submit" class="btn btn-danger">
                                    <i class="fas fa-save me-2"></i>Save Oracle Environment
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <!-- Elasticsearch Environment Form -->
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5><i class="fas fa-search me-2"></i>Add Elasticsearch Environment</h5>
                        </div>
                        <div class="card-body">
                            <form id="elasticsearchEnvironmentForm">
                                <div class="mb-3">
                                    <label for="elasticEnvName" class="form-label">Environment Name</label>
                                    <input type="text" class="form-control" id="elasticEnvName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="elasticEnvUrl" class="form-label">Elasticsearch URL</label>
                                    <input type="text" class="form-control" id="elasticEnvUrl" placeholder="http://localhost:9200" required>
                                    <div class="form-text">Format: http://hostname:port</div>
                                </div>
                                <div class="mb-3">
                                    <label for="elasticEnvUsername" class="form-label">Username (Optional)</label>
                                    <input type="text" class="form-control" id="elasticEnvUsername">
                                </div>
                                <div class="mb-3">
                                    <label for="elasticEnvPassword" class="form-label">Password (Optional)</label>
                                    <input type="password" class="form-control" id="elasticEnvPassword">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save Elasticsearch Environment
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-md-6">
                    <!-- Oracle Environments List -->
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h5><i class="fas fa-database me-2"></i>Oracle Environments</h5>
                        </div>
                        <div class="card-body">
                            <div id="oracleEnvironmentsList" class="row">
                                <!-- Oracle environment cards will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <!-- Elasticsearch Environments List -->
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5><i class="fas fa-search me-2"></i>Elasticsearch Environments</h5>
                        </div>
                        <div class="card-body">
                            <div id="elasticsearchEnvironmentsList" class="row">
                                <!-- Elasticsearch environment cards will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Indices & Mappings Tab -->
        <div class="tab-pane fade" id="indices" role="tabpanel">
            <div class="row">
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-header">
                            <h6>Select Environment</h6>
                        </div>
                        <div class="card-body">
                            <select id="indicesEnvironment" class="form-select mb-3">
                                <option value="">Select Environment...</option>
                            </select>
                            <button id="connectIndicesBtn" class="btn btn-success w-100" disabled>
                                <i class="fas fa-plug me-2"></i>Connect
                            </button>
                        </div>
                    </div>

                    <div class="card mt-3" id="indicesCard" style="display: none;">
                        <div class="card-header">
                            <h6>Elasticsearch Indices</h6>
                        </div>
                        <div class="card-body">
                            <div id="indicesList" class="list-group">
                                <!-- Indices will be populated here -->
                            </div>
                        </div>
                    </div>


                </div>
                <div class="col-md-9">
                    <div class="card">
                        <div class="card-header">
                            <h6>Index Mappings</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Available Indices</h6>
                                    <div id="availableIndices" class="border rounded p-3" style="height: 200px; overflow-y: auto;">
                                        <p class="text-muted">Connect to an environment to view indices</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Index Mapping</h6>
                                    <div id="indexMappingDisplay" class="border rounded p-3" style="height: 200px; overflow-y: auto;">
                                        <p class="text-muted">Select an index to view its mapping</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button id="refreshIndices" class="btn btn-primary" disabled>
                                    <i class="fas fa-sync me-2"></i>Refresh Indices
                                </button>
                                <button id="loadMappingToBuilder" class="btn btn-success ms-2" disabled>
                                    <i class="fas fa-download me-2"></i>Load Mapping to Builder
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mapping Builder Tab -->
        <div class="tab-pane fade" id="mapping" role="tabpanel">
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h6>Environment Selection</h6>
                        </div>
                        <div class="card-body">
                            <select id="mappingEnvironment" class="form-select mb-3">
                                <option value="">Select Environment...</option>
                            </select>

                            <!-- Oracle Table Selection -->
                            <div id="oracleTableSection" style="display: none;">
                                <label for="mappingTable" class="form-label">Select Table</label>
                                <select id="mappingTable" class="form-select mb-3" disabled>
                                    <option value="">Select Table...</option>
                                </select>
                            </div>

                            <!-- Elasticsearch Index Selection -->
                            <div id="elasticsearchIndexSection" style="display: none;">
                                <label for="mappingIndex" class="form-label">Select Index</label>
                                <select id="mappingIndex" class="form-select mb-3" disabled>
                                    <option value="">Select Index...</option>
                                </select>
                            </div>

                            <button id="loadColumns" class="btn btn-outline-primary w-100 mb-3" disabled>
                                <i class="fas fa-download me-2"></i>Load Fields
                            </button>

                            <div class="mb-3">
                                <label for="mappingName" class="form-label">Mapping Name</label>
                                <input type="text" class="form-control" id="mappingName" placeholder="Enter mapping name">
                            </div>
                            <button id="addField" class="btn btn-primary w-100">
                                <i class="fas fa-plus me-2"></i>Add Field
                            </button>
                        </div>
                    </div>


                </div>
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6>Mapping Builder</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="livePreviewToggle" checked>
                                <label class="form-check-label" for="livePreviewToggle">Live Preview</label>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Field Addition Controls -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <div class="btn-group w-100" role="group">
                                        <button type="button" class="btn btn-outline-primary" onclick="addFieldByType('text')">
                                            <i class="fas fa-font me-1"></i>Text
                                        </button>
                                        <button type="button" class="btn btn-outline-success" onclick="addFieldByType('long')">
                                            <i class="fas fa-hashtag me-1"></i>Number
                                        </button>
                                        <button type="button" class="btn btn-outline-warning" onclick="addFieldByType('date')">
                                            <i class="fas fa-calendar me-1"></i>Date
                                        </button>
                                        <button type="button" class="btn btn-outline-info" onclick="addFieldByType('boolean')">
                                            <i class="fas fa-toggle-on me-1"></i>Boolean
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" onclick="addFieldByType('keyword')">
                                            <i class="fas fa-key me-1"></i>Keyword
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Advanced Field Controls -->
                            <div class="row mb-3">
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-outline-dark w-100" onclick="addNestedField()">
                                        <i class="fas fa-layer-group me-1"></i>Nested Field
                                    </button>
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-outline-purple w-100" onclick="addParentChildField()">
                                        <i class="fas fa-link me-1"></i>Parent-Child
                                    </button>
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-outline-cyan w-100" onclick="showSavedMappings()">
                                        <i class="fas fa-save me-1"></i>Saved Mappings
                                    </button>
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-outline-secondary w-100" onclick="showCustomAnalyzerModal()">
                                        <i class="fas fa-microscope me-1"></i>Custom Analyzer
                                    </button>
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-outline-info w-100" onclick="showVectorEmbeddingModal()">
                                        <i class="fas fa-vector-square me-1"></i>Vector Embedding
                                    </button>
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-outline-success w-100" id="updateMappingButton">
                                        <i class="fas fa-upload me-1"></i>Update Mapping
                                    </button>
                                </div>
                            </div>
                            <div id="customAnalyzerList" class="mb-3"></div>

                            <!-- Columns Card (Initially Hidden) -->
                            <div id="columnsCard" class="card mb-3" style="display: none;">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">Available Fields</h6>
                                    <div class="d-flex align-items-center">
                                        <button id="selectAllColumns" class="btn btn-sm btn-outline-success me-2" disabled>
                                            <i class="fas fa-check-double me-1"></i>Select All
                                        </button>

                                        <div class="form-check form-switch m-0">
                                            <input class="form-check-input" type="checkbox" id="enableColumnSelection">
                                            <label class="form-check-label" for="enableColumnSelection">Enable Selection</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                                    <div id="columnsList">
                                        <!-- Columns will be populated here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Generate and Preview -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <button id="generateMapping" class="btn btn-success w-100" disabled>
                                        <i class="fas fa-magic me-2"></i>Generate Mapping
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button id="previewMapping" class="btn btn-outline-primary w-100">
                                        <i class="fas fa-eye me-2"></i>Preview Mapping
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button id="validateMapping" class="btn btn-outline-primary w-100" onclick="validateMappingModal()">
                                        <i class="fas fa-eye me-2"></i>ValidateMapping
                                    </button>
                                </div>
                            </div>

                            <!-- Enhanced Mapping Builder with Sections -->
                            <div id="mappingBuilder" class="mapping-builder">
                                <!-- Root Fields Section -->
                                <div class="section-header">
                                    <i class="fas fa-layer-group me-2"></i>Root Fields
                                </div>
                                <div id="rootFieldsSection" class="field-builder-section" ondrop="handleDrop(event, 'root')" ondragover="handleDragOver(event)">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-plus fa-2x mb-2"></i>
                                        <p>Add root-level fields here</p>
                                    </div>
                                </div>

                                <!-- Nested Fields Section -->
                                <div class="section-header mt-3">
                                    <i class="fas fa-sitemap me-2"></i>Nested Fields
                                </div>
                                <div id="nestedFieldsSection" class="field-builder-section nested-field-section" ondrop="handleDrop(event, 'nested')" ondragover="handleDragOver(event)">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-layer-group fa-2x mb-2"></i>
                                        <p>Drag nested fields here</p>
                                    </div>
                                </div>

                                <!-- Parent-Child Fields Section -->
                                <div class="section-header mt-3">
                                    <i class="fas fa-link me-2"></i>Parent-Child Relations
                                </div>
                                <div id="parentChildSection" class="field-builder-section parent-child-section" ondrop="handleDrop(event, 'parent-child')" ondragover="handleDragOver(event)">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-link fa-2x mb-2"></i>
                                        <p>Set up parent-child relationships here</p>
                                    </div>
                                </div>



                                <div class="section-header mt-3">
                                    <i class="fas fa-sitemap me-2"></i>AI Enhanced Fields
                                </div>
                                <div id="aiSection" class="field-builder-section nested-field-section" ondrop="handleDrop(event, 'nested')" ondragover="handleDragOver(event)">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-layer-group fa-2x mb-2"></i>
                                        <p>Drag nested fields here</p>
                                    </div>
                                    <div id="aiFieldsContainer">
                                        <!-- AI-generated fields will appear here -->
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>

                    <div class="card mt-3" id="mappingPreview">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6><i class="fas fa-eye me-2"></i>Mapping Preview</h6>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="copyPreviewBtn">
                                    <i class="fas fa-copy me-1"></i>Copy
                                </button>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="downloadPreviewBtn">
                                    <i class="fas fa-download me-1"></i>Download
                                </button>
                            </div>
                        </div>
                        <!-- Preview View Tabs -->
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-3" id="previewTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="json-preview-tab" data-bs-toggle="tab" data-bs-target="#json-preview" type="button" role="tab">
                                        <i class="fas fa-code me-2"></i>JSON View
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="visual-preview-tab" data-bs-toggle="tab" data-bs-target="#visual-preview" type="button" role="tab">
                                        <i class="fas fa-sitemap me-2"></i>Visual View
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="summary-preview-tab" data-bs-toggle="tab" data-bs-target="#summary-preview" type="button" role="tab">
                                        <i class="fas fa-list me-2"></i>Summary View
                                    </button>
                                </li>
                            </ul>

                            <div class="tab-content" id="previewTabContent">
                                <!-- JSON Preview Tab -->
                                <div class="tab-pane fade show active" id="json-preview" role="tabpanel">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div class="d-flex gap-2">
                                            <span class="badge bg-primary" id="fieldCount">0 fields</span>
                                            <span class="badge bg-info" id="mappingSize">0 KB</span>
                                            <span class="badge bg-success" id="validationBadge">Valid</span>
                                        </div>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-outline-secondary btn-sm" id="formatJsonBtn">
                                                <i class="fas fa-code me-1"></i>Format
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary btn-sm" id="minifyJsonBtn">
                                                <i class="fas fa-compress-alt me-1"></i>Minify
                                            </button>
                                            <button type="button" class="btn btn-outline-success btn-sm" id="saveToElasticsearchBtn" onclick="showSaveToElasticsearchModal()">
                                                <i class="fas fa-save me-1"></i>Save to Elasticsearch
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mapping-preview-container">
                                        <pre id="mappingJson" class="mapping-preview">Add fields to see live mapping preview...</pre>
                                    </div>
                                </div>

                                <!-- Visual Preview Tab -->
                                <div class="tab-pane fade" id="visual-preview" role="tabpanel">
                                    <div id="visualMappingDisplay" class="visual-mapping-container">
                                        <div class="text-center text-muted p-4">
                                            <i class="fas fa-sitemap fa-3x mb-3"></i>
                                            <p>Add fields to see visual mapping structure</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Summary Preview Tab -->
                                <div class="tab-pane fade" id="summary-preview" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Field Summary</h6>
                                            <div id="fieldSummary" class="mb-3">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-info-circle me-2"></i>No fields added yet
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Validation Status</h6>
                                            <div id="validationStatus">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-check-circle text-success me-2"></i>Ready to build
                                                </div>
                                            </div>

                                            <h6 class="mt-3">Mapping Statistics</h6>
                                            <div id="mappingStats">
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Total Fields:</span>
                                                    <span id="totalFields">0</span>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Nested Fields:</span>
                                                    <span id="nestedFields">0</span>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Text Fields:</span>
                                                    <span id="textFields">0</span>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Date Fields:</span>
                                                    <span id="dateFields">0</span>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Estimated Size:</span>
                                                    <span id="estimatedSize">0 KB</span>
                                                </div>
                                            </div>

                                            <h6 class="mt-3">Nested / Parent-Child Relations</h6>
                                            <div id="relationSummary">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-sitemap me-2"></i>No nested or parent-child fields
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Oracle Query Runner Tab -->
        <div class="tab-pane fade" id="oracle-query" role="tabpanel">
            <div class="row">
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h6><i class="fas fa-database me-2"></i>Oracle Environment</h6>
                        </div>
                        <div class="card-body">
                            <select id="queryOracleEnvironment" class="form-select mb-3">
                                <option value="">Select Oracle Environment...</option>
                            </select>
                            <button id="connectQueryBtn" class="btn btn-danger w-100 mb-3" disabled>
                                <i class="fas fa-plug me-2"></i>Connect
                            </button>
                            <div id="queryTablesSection" style="display: none;">
                                <h6>Tables</h6>
                                <div id="queryTablesList" class="list-group" style="max-height: 300px; overflow-y: auto;">
                                    <!-- Tables will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h5><i class="fas fa-code me-2"></i>SQL Query Editor</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="sqlQuery" class="form-label">SQL Query</label>
                                <textarea id="sqlQuery" class="form-control query-editor" rows="8" placeholder="Enter your SQL query here..."></textarea>
                            </div>
                            <div class="d-flex gap-2 mb-3">
                                <button id="executeQueryBtn" class="btn btn-success" disabled>
                                    <i class="fas fa-play me-2"></i>Execute Query
                                </button>
                                <button id="clearQueryBtn" class="btn btn-secondary">
                                    <i class="fas fa-trash me-2"></i>Clear
                                </button>
                                <button id="formatQueryBtn" class="btn btn-info">
                                    <i class="fas fa-magic me-2"></i>Format
                                </button>
                            </div>
                            <div id="queryResults" style="display: none;">
                                <h6>Query Results</h6>
                                <div class="results-table">
                                    <table id="resultsTable" class="table table-striped table-sm">
                                        <thead id="resultsTableHead"></thead>
                                        <tbody id="resultsTableBody"></tbody>
                                    </table>
                                </div>
                                <div id="queryInfo" class="mt-2 text-muted small"></div>
                            </div>
                            <div id="queryError" class="alert alert-danger mt-3" style="display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Oracle Mapping Builder Tab -->
        <div class="tab-pane fade" id="oracle-mapping" role="tabpanel">
            <div class="row">
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h6><i class="fas fa-database me-2"></i>Oracle Environment</h6>
                        </div>
                        <div class="card-body">
                            <select id="mappingOracleEnvironment" class="form-select mb-3">
                                <option value="">Select Oracle Environment...</option>
                            </select>
                            <button id="connectMappingBtn" class="btn btn-danger w-100 mb-3" disabled>
                                <i class="fas fa-plug me-2"></i>Connect
                            </button>
                            <div id="mappingTablesSection" style="display: none;">
                                <h6>Select Table</h6>
                                <select id="mappingTableSelect" class="form-select mb-3">
                                    <option value="">Select Table...</option>
                                </select>
                                <button id="loadTableStructureBtn" class="btn btn-outline-danger w-100" disabled>
                                    <i class="fas fa-table me-2"></i>Load Table Structure
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h5><i class="fas fa-project-diagram me-2"></i>Oracle Table Mapping Builder</h5>
                        </div>
                        <div class="card-body">
                            <div id="oracleTableColumnsSection" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Oracle Table Columns</h6>
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between">
                                                <button type="button" class="btn btn-sm btn-outline-success" onclick="selectAllOracleColumns()">
                                                    <i class="fas fa-check-double me-1"></i>Select All
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-warning" onclick="clearAllOracleColumns()">
                                                    <i class="fas fa-times me-1"></i>Clear All
                                                </button>
                                            </div>
                                        </div>
                                        <div id="oracleColumnsList" class="border rounded p-3" style="max-height: 400px; overflow-y: auto;">
                                            <!-- Oracle columns will be populated here -->
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6><i class="fas fa-eye me-2"></i>Elasticsearch Mapping Preview</h6>
                                            <div class="btn-group" role="group">
                                                <button type="button" class="btn btn-outline-secondary btn-sm" id="copyOraclePreviewBtn">
                                                    <i class="fas fa-copy me-1"></i>Copy
                                                </button>
                                                <button type="button" class="btn btn-outline-info btn-sm" id="refreshOraclePreviewBtn">
                                                    <i class="fas fa-sync me-1"></i>Refresh
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="oracleMappingName" class="form-label">Mapping Name</label>
                                            <input type="text" class="form-control" id="oracleMappingName" placeholder="Enter mapping name" oninput="updateOracleMappingButtons()">
                                        </div>
                                        <div class="mb-2">
                                            <div class="row">
                                                <div class="col-6">
                                                    <span class="badge bg-danger" id="oracleFieldCount">0 columns</span>
                                                </div>
                                                <div class="col-6 text-end">
                                                    <span class="badge bg-info" id="oracleMappingSize">0 KB</span>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Oracle Preview Tabs -->
                                        <ul class="nav nav-tabs mb-3" id="oraclePreviewTabs" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link active" id="oracle-json-tab" data-bs-toggle="tab" data-bs-target="#oracle-json" type="button" role="tab">
                                                    <i class="fas fa-code me-2"></i>JSON
                                                </button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="oracle-visual-tab" data-bs-toggle="tab" data-bs-target="#oracle-visual" type="button" role="tab">
                                                    <i class="fas fa-sitemap me-2"></i>Visual
                                                </button>
                                            </li>
                                        </ul>

                                        <div class="tab-content" id="oraclePreviewTabContent">
                                            <!-- Oracle JSON Preview -->
                                            <div class="tab-pane fade show active" id="oracle-json" role="tabpanel">
                                                <div class="mapping-preview-container oracle-preview">
                                                    <pre id="oracleMappingPreview" class="mapping-preview">Select Oracle columns to generate mapping preview...</pre>
                                                </div>
                                            </div>

                                            <!-- Oracle Visual Preview -->
                                            <div class="tab-pane fade" id="oracle-visual" role="tabpanel">
                                                <div id="oracleVisualDisplay" class="visual-mapping-container oracle-preview">
                                                    <div class="text-center text-muted p-4">
                                                        <i class="fas fa-database fa-3x mb-3 text-danger"></i>
                                                        <p>Select Oracle columns to see visual mapping structure</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <div class="row">
                                                <div class="col-6">
                                                    <button id="previewOracleBtn" class="btn btn-outline-primary w-100" onclick="updateOracleMappingPreview()">
                                                        <i class="fas fa-eye me-2"></i>Preview
                                                    </button>
                                                </div>
                                                <div class="col-6">
                                                    <button id="generateOracleBtn" class="btn btn-primary w-100" disabled>
                                                        <i class="fas fa-cogs me-2"></i>Generate
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="oracleNoTableSelected" class="text-center text-muted py-5">
                                <i class="fas fa-table fa-3x mb-3"></i>
                                <h5>Select an Oracle table to start building mappings</h5>
                                <p>Choose an Oracle environment and table from the left panel to begin.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Saved Mappings Tab -->
        <div class="tab-pane fade" id="mappings-list" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-list me-2"></i>Saved Mappings</h5>
                </div>
                <div class="card-body">
                    <div id="savedMappingsList">
                        <!-- Saved mappings will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="enhanced-indices" role="tabpanel">
            <div class="container-fluid">
                <!-- Header Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="mb-2">
                                    <i class="fas fa-layer-group me-3 text-success"></i>
                                    Enhanced Indices & Mappings Manager
                                </h2>
                                <p class="text-muted mb-0">Advanced Elasticsearch indices management, mapping visualization, and settings configuration</p>
                            </div>
                            <div class="d-flex gap-2">
                                <button id="refreshAllIndicesBtn" class="btn btn-outline-primary">
                                    <i class="fas fa-sync me-2"></i>Refresh All
                                </button>
                                <button id="exportAllMappingsBtn" class="btn btn-outline-success">
                                    <i class="fas fa-download me-2"></i>Export Mappings
                                </button>
                                <button id="bulkOperationsBtn" class="btn btn-outline-warning">
                                    <i class="fas fa-tasks me-2"></i>Bulk Operations
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Environment Selection & Connection -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="environment-selector fade-in">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <label for="enhancedIndicesEnvironment" class="form-label fw-bold">
                                        <i class="fas fa-server me-2"></i>Select Environment
                                    </label>
                                    <select id="enhancedIndicesEnvironment" class="form-select">
                                        <option value="">Choose Environment...</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label fw-bold">Connection Status</label>
                                    <div>
                                <span id="enhancedConnectionStatus" class="connection-status status-disconnected">
                                    <i class="fas fa-circle"></i>
                                    Disconnected
                                </span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label fw-bold">Cluster Health</label>
                                    <div>
                                        <span id="clusterHealth" class="badge bg-secondary">Unknown</span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <button id="connectEnhancedIndicesBtn" class="btn btn-success w-100" disabled>
                                        <i class="fas fa-plug me-2"></i>Connect to Environment
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="row">
                    <!-- Left Panel - Indices List -->
                    <div class="col-md-4">
                        <div class="indices-container">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">
                                    <i class="fas fa-database me-2 text-primary"></i>
                                    Available Indices
                                </h5>
                                <span id="enhancedIndicesCount" class="badge bg-primary">0 indices</span>
                            </div>

                            <!-- Search and Filter -->
                            <div class="mb-3">
                                <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-search"></i>
                            </span>
                                    <input type="text" class="form-control" id="enhancedIndexSearch"
                                           placeholder="Search indices...">
                                </div>
                            </div>

                            <!-- Advanced Filters -->
                            <div class="mb-3">
                                <div class="row">
                                    <div class="col-6">
                                        <label class="form-label small">Health Filter</label>
                                        <div class="btn-group w-100" role="group">
                                            <input type="radio" class="btn-check" name="enhancedHealthFilter" id="enhancedAllHealth" value="all" checked>
                                            <label class="btn btn-outline-secondary btn-sm" for="enhancedAllHealth">All</label>
                                            <input type="radio" class="btn-check" name="enhancedHealthFilter" id="enhancedGreenHealth" value="green">
                                            <label class="btn btn-outline-success btn-sm" for="enhancedGreenHealth">Green</label>
                                            <input type="radio" class="btn-check" name="enhancedHealthFilter" id="enhancedYellowHealth" value="yellow">
                                            <label class="btn btn-outline-warning btn-sm" for="enhancedYellowHealth">Yellow</label>
                                            <input type="radio" class="btn-check" name="enhancedHealthFilter" id="enhancedRedHealth" value="red">
                                            <label class="btn btn-outline-danger btn-sm" for="enhancedRedHealth">Red</label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label small">Size Filter</label>
                                        <select class="form-select form-select-sm" id="sizeFilter">
                                            <option value="all">All Sizes</option>
                                            <option value="small">< 100MB</option>
                                            <option value="medium">100MB - 1GB</option>
                                            <option value="large">1GB - 10GB</option>
                                            <option value="xlarge">> 10GB</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Bulk Selection -->
                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="selectAllIndices">
                                        <label class="form-check-label" for="selectAllIndices">
                                            Select All
                                        </label>
                                    </div>
                                    <span id="selectedIndicesCount" class="badge bg-info">0 selected</span>
                                </div>
                            </div>

                            <!-- Indices List -->
                            <div id="enhancedIndicesList" style="max-height: 600px; overflow-y: auto;">
                                <div class="text-center text-muted py-5">
                                    <i class="fas fa-database fa-3x mb-3"></i>
                                    <p>Connect to an environment to view indices</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel - Mapping Details -->
                    <div class="col-md-8">
                        <!-- Action Toolbar -->
                        <div class="action-toolbar" id="enhancedMappingToolbar" style="display: none;">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h6 class="mb-0">
                                        <i class="fas fa-cog me-2"></i>
                                        Index Operations
                                    </h6>
                                </div>
                                <div class="col-md-6 text-end">
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-outline-light btn-sm" onclick="viewEnhancedMappingJson()">
                                            <i class="fas fa-code me-1"></i>JSON
                                        </button>
                                        <button class="btn btn-outline-light btn-sm" onclick="editEnhancedMappingSettings()">
                                            <i class="fas fa-edit me-1"></i>Settings
                                        </button>
                                        <button class="btn btn-outline-light btn-sm" onclick="deepDiveEnhancedMapping()">
                                            <i class="fas fa-search-plus me-1"></i>Deep Dive
                                        </button>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Mapping Display Tabs -->
                        <div class="card" id="enhancedMappingCard" style="display: none;">
                            <div class="card-header">
                                <ul class="nav nav-tabs card-header-tabs" id="enhancedMappingTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="enhanced-overview-tab" data-bs-toggle="tab"
                                                data-bs-target="#enhanced-overview" type="button" role="tab">
                                            <i class="fas fa-info-circle me-2"></i>Overview
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="enhanced-mappings-tab" data-bs-toggle="tab"
                                                data-bs-target="#enhanced-mappings" type="button" role="tab">
                                            <i class="fas fa-project-diagram me-2"></i>Mappings
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="enhanced-settings-tab" data-bs-toggle="tab"
                                                data-bs-target="#enhanced-settings" type="button" role="tab">
                                            <i class="fas fa-cogs me-2"></i>Settings
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="enhanced-aliases-tab" data-bs-toggle="tab"
                                                data-bs-target="#enhanced-aliases" type="button" role="tab">
                                            <i class="fas fa-link me-2"></i>Aliases
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="enhanced-performance-tab" data-bs-toggle="tab"
                                                data-bs-target="#enhanced-performance" type="button" role="tab">
                                            <i class="fas fa-tachometer-alt me-2"></i>Performance
                                        </button>
                                    </li>
                                </ul>
                            </div>

                            <div class="card-body">
                                <div class="tab-content" id="enhancedMappingTabContent">
                                    <!-- Overview Tab -->
                                    <div class="tab-pane fade show active" id="enhanced-overview" role="tabpanel">
                                        <div id="enhancedIndexOverview">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <h6>Index Statistics</h6>
                                                    <div id="enhancedIndexStats" class="settings-item">
                                                        <!-- Will be populated dynamically -->
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <h6>Health Information</h6>
                                                    <div id="enhancedHealthInfo" class="settings-item">
                                                        <!-- Will be populated dynamically -->
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <h6>Storage Details</h6>
                                                    <div id="storageDetails" class="settings-item">
                                                        <!-- Will be populated dynamically -->
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-12">
                                                    <h6>Recent Activity</h6>
                                                    <div id="recentActivity" class="settings-item">
                                                        <!-- Will be populated dynamically -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Enhanced Mappings Tab -->
                                    <div class="tab-pane fade" id="enhanced-mappings" role="tabpanel">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6>Field Mappings</h6>
                                            <div class="btn-group" role="group">
                                                <button class="btn btn-outline-primary btn-sm" onclick="toggleEnhancedMappingView('tree')">
                                                    <i class="fas fa-sitemap me-1"></i>Tree
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="toggleEnhancedMappingView('table')">
                                                    <i class="fas fa-table me-1"></i>Table
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="toggleEnhancedMappingView('json')">
                                                    <i class="fas fa-code me-1"></i>JSON
                                                </button>
                                                <button class="btn btn-outline-primary btn-sm" onclick="toggleEnhancedMappingView('graph')">
                                                    <i class="fas fa-project-diagram me-1"></i>Graph
                                                </button>
                                            </div>
                                        </div>

                                        <div id="enhancedMappingDisplay">
                                            <!-- Enhanced mapping content will be displayed here -->
                                        </div>
                                    </div>

                                    <!-- Enhanced Settings Tab -->
                                    <div class="tab-pane fade" id="enhanced-settings" role="tabpanel">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6>Index Settings</h6>
                                            <div class="btn-group" role="group">
                                                <button class="btn btn-outline-success btn-sm" onclick="saveEnhancedSettings()">
                                                    <i class="fas fa-save me-1"></i>Save Changes
                                                </button>
                                                <button class="btn btn-outline-warning btn-sm" onclick="resetEnhancedSettings()">
                                                    <i class="fas fa-undo me-1"></i>Reset
                                                </button>
                                                <button class="btn btn-outline-info btn-sm" onclick="compareSettings()">
                                                    <i class="fas fa-balance-scale me-1"></i>Compare
                                                </button>
                                                <button class="advanced-toggle btn-sm" onclick="toggleEnhancedAdvancedSettings()">
                                                    <i class="fas fa-cogs me-1"></i>Advanced
                                                </button>
                                            </div>
                                        </div>

                                        <div id="enhancedSettingsEditor">
                                            <!-- Enhanced settings will be loaded here -->
                                        </div>
                                    </div>

                                    <!-- Enhanced Aliases Tab -->
                                    <div class="tab-pane fade" id="enhanced-aliases" role="tabpanel">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6>Index Aliases</h6>
                                            <div class="btn-group" role="group">
                                                <button class="btn btn-outline-primary btn-sm" onclick="addEnhancedAlias()">
                                                    <i class="fas fa-plus me-1"></i>Add Alias
                                                </button>
                                                <button class="btn btn-outline-info btn-sm" onclick="bulkAliasOperations()">
                                                    <i class="fas fa-tasks me-1"></i>Bulk Operations
                                                </button>
                                            </div>
                                        </div>

                                        <div id="enhancedAliasesDisplay">
                                            <!-- Enhanced aliases will be displayed here -->
                                        </div>
                                    </div>

                                    <!-- Performance Tab -->
                                </div>
                                <div class="tab-pane fade" id="enhanced-performance" role="tabpanel">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6>Performance Metrics</h6>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-outline-primary btn-sm" onclick="refreshPerformanceMetrics()">
                                                <i class="fas fa-sync me-1"></i>Refresh
                                            </button>
                                            <button class="btn btn-outline-info btn-sm" onclick="performanceAnalysis()">
                                                <i class="fas fa-chart-line me-1"></i>Analysis
                                            </button>
                                        </div>
                                    </div>

                                    <div id="performanceMetrics">
                                        <!-- Performance metrics will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>



<div class="modal fade" id="enhancedDeepDiveModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title">
                    <i class="fas fa-search-plus me-2"></i>Enhanced Deep Dive Mapping Explorer
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div class="deep-dive-container">
                    <!-- Breadcrumb Navigation -->
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb breadcrumb-nav">
                            <li class="breadcrumb-item active" id="enhancedRootBreadcrumb">
                                <i class="fas fa-home me-1"></i>Root
                            </li>
                        </ol>
                    </nav>

                    <div class="row">
                        <!-- Navigation Tree -->
                        <div class="col-md-4">
                            <h6 class="text-white mb-3">Field Navigator</h6>
                            <div id="enhancedFieldNavigator" style="max-height: 500px; overflow-y: auto;">
                                <!-- Field tree will be populated here -->
                            </div>
                        </div>

                        <!-- Field Details -->
                        <div class="col-md-8">
                            <h6 class="text-white mb-3">Field Details & Analysis</h6>
                            <div id="enhancedFieldDetails">
                                <div class="text-center text-muted py-5">
                                    <i class="fas fa-mouse-pointer fa-3x mb-3"></i>
                                    <p>Select a field from the navigator to view enhanced details</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="exportEnhancedFieldMapping()">
                    <i class="fas fa-download me-2"></i>Export Field
                </button>
                <button type="button" class="btn btn-success" onclick="optimizeField()">
                    <i class="fas fa-magic me-2"></i>Optimize Field
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Operations Modal -->
<div class="modal fade" id="bulkOperationsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-tasks me-2"></i>Bulk Index Operations
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h6>Selected Indices (<span id="bulkSelectedCount">0</span>)</h6>
                    <div id="bulkSelectedIndices" class="mb-3">
                        <!-- Selected indices will be listed here -->
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h6>Operations</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" onclick="bulkUpdateSettings()">
                                <i class="fas fa-cogs me-2"></i>Update Settings
                            </button>
                            <button class="btn btn-outline-success" onclick="bulkCreateAliases()">
                                <i class="fas fa-link me-2"></i>Create Aliases
                            </button>
                            <button class="btn btn-outline-warning" onclick="bulkReindex()">
                                <i class="fas fa-sync-alt me-2"></i>Reindex All
                            </button>
                            <button class="btn btn-outline-info" onclick="bulkExportMappings()">
                                <i class="fas fa-download me-2"></i>Export Mappings
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Advanced Operations</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-secondary" onclick="bulkClose()">
                                <i class="fas fa-lock me-2"></i>Close Indices
                            </button>
                            <button class="btn btn-outline-primary" onclick="bulkOpen()">
                                <i class="fas fa-unlock me-2"></i>Open Indices
                            </button>
                            <button class="btn btn-outline-warning" onclick="bulkForcemerge()">
                                <i class="fas fa-compress me-2"></i>Force Merge
                            </button>
                            <button class="btn btn-outline-danger" onclick="bulkDelete()">
                                <i class="fas fa-trash me-2"></i>Delete Indices
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Settings Modal -->
<div class="modal fade" id="enhancedSettingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-cogs me-2"></i>Advanced Settings Editor
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Settings Categories -->
                    <div class="col-md-3">
                        <h6>Settings Categories</h6>
                        <div class="list-group" id="enhancedSettingsCategories">
                            <button type="button" class="list-group-item list-group-item-action active"
                                    onclick="showEnhancedSettingsCategory('general')">
                                <i class="fas fa-cog me-2"></i>General
                            </button>
                            <button type="button" class="list-group-item list-group-item-action"
                                    onclick="showEnhancedSettingsCategory('index')">
                                <i class="fas fa-database me-2"></i>Index Settings
                            </button>
                            <button type="button" class="list-group-item list-group-item-action"
                                    onclick="showEnhancedSettingsCategory('analysis')">
                                <i class="fas fa-search me-2"></i>Analysis
                            </button>
                            <button type="button" class="list-group-item list-group-item-action"
                                    onclick="showEnhancedSettingsCategory('mapping')">
                                <i class="fas fa-project-diagram me-2"></i>Mapping
                            </button>
                            <button type="button" class="list-group-item list-group-item-action"
                                    onclick="showEnhancedSettingsCategory('performance')">
                                <i class="fas fa-tachometer-alt me-2"></i>Performance
                            </button>
                            <button type="button" class="list-group-item list-group-item-action"
                                    onclick="showEnhancedSettingsCategory('security')">
                                <i class="fas fa-shield-alt me-2"></i>Security
                            </button>
                        </div>
                    </div>

                    <!-- Settings Form -->
                    <div class="col-md-9">
                        <div id="enhancedSettingsForm">
                            <!-- Settings form will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" onclick="previewEnhancedSettingsChanges()">
                    <i class="fas fa-eye me-2"></i>Preview Changes
                </button>
                <button type="button" class="btn btn-success" onclick="applyEnhancedSettingsChanges()">
                    <i class="fas fa-save me-2"></i>Apply Changes
                </button>
            </div>
        </div>
    </div>
</div>
<!--  ADD THIS NEW TAB CONTENT -->
<div class="tab-pane fade" id="oracle-env-connection" role="tabpanel">
    <div class="container-fluid">


        <!-- Progress Indicator -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="progress-indicator text-center">
                    <span class="progress-step active" id="step-connect" onclick="goToStep(1)">
                        <i class="fas fa-plug me-2"></i>Connect
                    </span>
                    <span class="progress-step" id="step-select" onclick="goToStep(2)">
                        <i class="fas fa-table me-2"></i>Select Tables
                    </span>
                    <span class="progress-step" id="step-structure" onclick="goToStep(3)">
                        <i class="fas fa-sitemap me-2"></i>Load Structures
                    </span>
                    <span class="progress-step" id="step-relationships" onclick="goToStep(4)">
                        <i class="fas fa-link me-2"></i>Define Relations
                    </span>
                    <span class="progress-step" id="step-configure" onclick="goToStep(5)">
                        <i class="fas fa-cogs me-2"></i>Configure Fields
                    </span>
                    <span class="progress-step" id="step-generate" onclick="goToStep(6)">
                        <i class="fas fa-magic me-2"></i>Generate & Save
                    </span>
                </div>
            </div>
        </div>

        <!-- Step 1: Connect to Oracle -->
        <div class="workflow-step active" id="workflow-step-1">
            <div class="step-header">
                <div class="step-number">1</div>
                <div>
                    <h4><i class="fas fa-database me-2 text-danger"></i>Connect to Oracle Environment</h4>
                    <p class="text-muted mb-0">Select and connect to your Oracle database environment</p>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h6><i class="fas fa-server me-2"></i>Oracle Environment Selection</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="workflowOracleEnvironment" class="form-label">Select Oracle Environment</label>
                                <select id="workflowOracleEnvironment" class="form-select">
                                    <option value="">Choose Oracle Environment...</option>
                                </select>
                            </div>
                            <button id="connectWorkflowOracle" class="btn btn-danger w-100" disabled>
                                <i class="fas fa-plug me-2"></i>Connect to Oracle
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h6><i class="fas fa-info-circle me-2"></i>Connection Status</h6>
                        </div>
                        <div class="card-body">
                            <div id="workflowConnectionStatus">
                                <div class="text-center text-muted py-4">
                                    <i class="fas fa-plug fa-3x mb-3"></i>
                                    <p>Select an Oracle environment to begin</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Select Multiple Tables -->
        <div class="workflow-step" id="workflow-step-2">
            <div class="step-header">
                <div class="step-number">2</div>
                <div>
                    <h4><i class="fas fa-table me-2 text-primary"></i>Select Multiple Tables</h4>
                    <p class="text-muted mb-0">Hold Ctrl/Cmd to select multiple tables for mapping</p>
                </div>
            </div>

            <div class="row">
                <div class="col-md-8">
                    <div class="bulk-action-bar">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h6 class="mb-0">
                                    <i class="fas fa-tasks me-2"></i>
                                    Bulk Actions
                                    <span id="selectedTablesCount" class="badge bg-light text-dark ms-2">0 selected</span>
                                </h6>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-outline-light btn-sm me-2" onclick="selectAllTables()">
                                    <i class="fas fa-check-double me-1"></i>Select All
                                </button>
                                <button class="btn btn-outline-light btn-sm" onclick="clearTableSelection()">
                                    <i class="fas fa-times me-1"></i>Clear Selection
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="multi-select-table" id="workflowTablesList">
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-table fa-3x mb-3"></i>
                            <p>Connect to Oracle environment to load tables</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h6><i class="fas fa-info-circle me-2"></i>Selection Summary</h6>
                        </div>
                        <div class="card-body">
                            <div id="tableSelectionSummary">
                                <p class="text-muted">No tables selected yet</p>
                            </div>
                            <button id="loadSelectedStructures" class="btn btn-primary w-100 mt-3" disabled>
                                <i class="fas fa-download me-2"></i>Load Table Structures
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Load Table Structures -->
        <div class="workflow-step" id="workflow-step-3">
            <div class="step-header">
                <div class="step-number">3</div>
                <div>
                    <h4><i class="fas fa-sitemap me-2 text-success"></i>Load Table Structures</h4>
                    <p class="text-muted mb-0">Analyze table schemas and relationships</p>
                </div>
            </div>

            <div id="tableStructuresContainer">
                <div class="text-center text-muted py-5">
                    <i class="fas fa-sitemap fa-3x mb-3"></i>
                    <p>Select tables to load their structures</p>
                </div>
            </div>
        </div>

        <!-- Step 4: Auto-Detection & Define Relationships -->
        <div class="workflow-step" id="workflow-step-4">
            <div class="step-header">
                <div class="step-number">4</div>
                <div>
                    <h4><i class="fas fa-link me-2 text-warning"></i>Define Relationships</h4>
                    <p class="text-muted mb-0">Set up nested fields and parent-child relationships</p>
                </div>
            </div>

            <!-- Auto-Detection Panel -->
            <div class="auto-detection-panel">
                <div class="row">
                    <div class="col-md-8">
                        <h5><i class="fas fa-magic me-2"></i>Auto-Detection</h5>
                        <p class="mb-3">Run a JOIN query to auto-detect relationships and field mappings</p>

                        <div class="mb-3">
                            <label for="autoDetectionQuery" class="form-label">JOIN Query for Auto-Detection</label>
                            <textarea id="autoDetectionQuery" class="form-control sql-editor" rows="6"
                                      placeholder="SELECT t1.*, t2.* FROM table1 t1 JOIN table2 t2 ON t1.id = t2.table1_id"></textarea>
                        </div>

                        <button id="runAutoDetection" class="btn btn-success">
                            <i class="fas fa-search me-2"></i>Run Auto-Detection
                        </button>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6><i class="fas fa-lightbulb me-2"></i>Auto-Detection Tips</h6>
                                <ul class="small mb-0">
                                    <li>Use JOIN queries between your selected tables</li>
                                    <li>Include foreign key relationships</li>
                                    <li>System will analyze query structure</li>
                                    <li>Relationships will be pre-configured</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manual Relationship Builder -->
            <div class="relationship-builder">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5><i class="fas fa-wrench me-2"></i>Manual Relationship Configuration</h5>
                    <button class="btn btn-outline-primary btn-sm" onclick="addRelationship()">
                        <i class="fas fa-plus me-2"></i>Add Relationship
                    </button>
                </div>

                <div id="relationshipsContainer">
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-link fa-2x mb-3"></i>
                        <p>Use auto-detection or manually add relationships</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Configure Fields -->
        <div class="workflow-step" id="workflow-step-5">
            <div class="step-header">
                <div class="step-number">5</div>
                <div>
                    <h4><i class="fas fa-cogs me-2 text-info"></i>Configure Fields</h4>
                    <p class="text-muted mb-0">Map Oracle fields to Elasticsearch types</p>
                </div>
            </div>

            <div id="fieldMappingContainer">
                <div class="text-center text-muted py-5">
                    <i class="fas fa-cogs fa-3x mb-3"></i>
                    <p>Define relationships to configure field mappings</p>
                </div>
            </div>
        </div>

        <!-- Step 6: Generate & Save -->
        <div class="workflow-step" id="workflow-step-6">
            <div class="step-header">
                <div class="step-number">
                    <i class="fas fa-check"></i>
                </div>
                <div>
                    <h4><i class="fas fa-magic me-2 text-purple"></i>Generate & Save</h4>
                    <p class="text-muted mb-0">Create Elasticsearch mapping and save to index</p>
                </div>
            </div>

            <div class="generation-summary" style="background: linear-gradient(135deg, #e2f3ff 0%, #b8e0ff 100%); border: 2px solid #0d6efd; border-radius: 12px; padding: 20px; margin: 20px 0;">
                <h5><i class="fas fa-chart-bar me-2"></i>Mapping Summary</h5>
                <div id="mappingSummaryContent">
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-chart-bar fa-3x mb-3"></i>
                        <p>Complete previous steps to see mapping summary</p>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h6><i class="fas fa-save me-2"></i>Save Configuration</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="workflowMappingName" class="form-label">Mapping Name</label>
                                <input type="text" class="form-control" id="workflowMappingName"
                                       placeholder="Enter mapping name">
                            </div>
                            <div class="mb-3">
                                <label for="workflowIndexName" class="form-label">Elasticsearch Index Name</label>
                                <input type="text" class="form-control" id="workflowIndexName"
                                       placeholder="Enter index name">
                            </div>
                            <div class="mb-3">
                                <label for="workflowElasticEnvironment" class="form-label">Elasticsearch Environment</label>
                                <select id="workflowElasticEnvironment" class="form-select">
                                    <option value="">Select environment...</option>
                                </select>
                            </div>
                            <div class="d-grid gap-2">
                                <button id="generateWorkflowMappingBtn" class="btn btn-primary" disabled>
                                    <i class="fas fa-magic me-2"></i>Generate Mapping
                                </button>
                                <button id="saveWorkflowMappingBtn" class="btn btn-success" disabled>
                                    <i class="fas fa-save me-2"></i>Save Mapping to Elasticsearch
                                </button>
                                <button id="previewWorkflowMappingBtn" class="btn btn-secondary" disabled>
                                    <i class="fas fa-eye me-2"></i>Mapping Preview
                                </button>
                                <button id="fieldDataMappingBtn" class="btn btn-warning" disabled>
                                    <i class="fas fa-columns me-2"></i>Field Data Mapping
                                </button>
                                <button id="dataLoadBtn" class="btn btn-info">
                                    <i class="fas fa-database me-2"></i>Data Load
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Mapping Preview Modal -->
<div class="modal fade" id="workflowPreviewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-eye me-2"></i>Mapping Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <pre id="workflowPreviewContent" class="small text-muted">No mapping generated.</pre>
            </div>
        </div>
    </div>
</div>

<!-- Field Data Mapping Modal -->
<div class="modal fade" id="fieldDataMappingModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-columns me-2"></i>Field Data Mapping</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Oracle Column</th>
                                <th>Elasticsearch Field</th>
                            </tr>
                        </thead>
                        <tbody id="fieldDataMappingBody">
                            <tr>
                                <td colspan="2" class="text-center text-muted">No data available</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveFieldDataMappingBtn">
                    <i class="fas fa-save me-2"></i>Save
                </button>
            </div>
    </div>
</div>
</div>

<!-- Data Load Modal -->
<div class="modal fade" id="dataLoadModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title"><i class="fas fa-database me-2"></i>Data Load</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="dataLoadOracleEnv" class="form-label">Oracle Environment</label>
                    <select id="dataLoadOracleEnv" class="form-select"></select>
                </div>
                <div class="mb-3">
                    <label for="dataLoadElasticEnv" class="form-label">Elasticsearch Environment</label>
                    <select id="dataLoadElasticEnv" class="form-select"></select>
                </div>
                <div class="mb-3">
                    <label for="dataLoadElasticsearchIndex" class="form-label">Elasticsearch Index</label>
                    <select id="dataLoadElasticsearchIndex" class="form-select">
                        <option value="">Select index...</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="dataLoadQuery" class="form-label">Oracle Query</label>
                    <textarea id="dataLoadQuery" class="form-control" rows="4" placeholder="SELECT * FROM table"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="runDataLoadBtn">
                    <i class="fas fa-play me-2"></i>Run Data Load
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Field Configuration Modal with Nested Field Support -->
<div class="modal fade" id="fieldConfigModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Configure Field</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Basic Configuration -->
                    <div class="col-md-6">
                        <h6 class="text-primary mb-3"><i class="fas fa-cog me-2"></i>Basic Configuration</h6>
                        <form id="fieldConfigForm">
                            <div class="mb-3">
                                <label for="fieldName" class="form-label">Field Name</label>
                                <input type="text" class="form-control" id="fieldName" readonly>
                            </div>
                            <div class="mb-3">
                                <label for="elasticType" class="form-label">Elasticsearch Type</label>
                                <select class="form-select" id="elasticType">
                                    <option value="text">Text</option>
                                    <option value="keyword">Keyword</option>
                                    <option value="long">Long</option>
                                    <option value="integer">Integer</option>
                                    <option value="double">Double</option>
                                    <option value="float">Float</option>
                                    <option value="date">Date</option>
                                    <option value="boolean">Boolean</option>
                                    <option value="binary">Binary</option>
                                    <option value="nested">Nested</option>
                                    <option value="object">Object</option>
                                    <option value="join">Join (Parent-Child)</option>
                                </select>
                            </div>

                            <!-- UI Component Type Selection -->
                            <div class="mb-3" id="uiComponentType">

                            </div>

                            <!-- Dropdown Configuration (shown only when dropdown is selected) -->
                            <div id="dropdownConfig" class="mb-3" style="display: none;">
                                <div class="border rounded p-3 bg-light">
                                    <h6 class="mb-3">Dropdown Configuration</h6>
                                    <div class="mb-3">
                                        <label for="sourceIndex" class="form-label">Source Index</label>
                                        <select class="form-select" id="sourceIndex" onchange="loadDropdownIndexMapping()">
                                            <option value="">Select source index...</option>
                                            <option value="categories">Categories Index</option>
                                            <option value="products">Products Index</option>
                                            <option value="users">Users Index</option>
                                            <option value="orders">Orders Index</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="keyField" class="form-label">Key Field</label>
                                        <select class="form-select" id="keyField">
                                            <option value="">Select key field...</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="valueField" class="form-label">Value Field</label>
                                        <select class="form-select" id="valueField">
                                            <option value="">Select value field...</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced field options -->
                            <div class="mb-3" id="textOptions" style="display: none;">
                                <label for="analyzer" class="form-label">Analyzer</label>
                                <select class="form-select" id="analyzer"></select>
                                <label for="similarity" class="form-label mt-3">Similarity</label>
                                <select class="form-select" id="similarity"></select>
                            </div>


                            <div class="mb-3" id="dateOptions" style="display: none;">
                                <label for="dateFormat" class="form-label">Date Format</label>
                                <select class="form-select" id="dateFormat">
                                    <option value="">Default</option>
                                    <option value="yyyy-MM-dd">yyyy-MM-dd</option>
                                    <option value="yyyy-MM-dd HH:mm:ss">yyyy-MM-dd HH:mm:ss</option>
                                    <option value="yyyy-MM-dd'T'HH:mm:ss.SSS'Z'">ISO 8601</option>
                                    <option value="epoch_millis">Epoch Milliseconds</option>
                                    <option value="epoch_second">Epoch Seconds</option>
                                </select>
                            </div>

                            <div class="mb-3" id="joinOptions" style="display: none;">
                                <label for="joinRelations" class="form-label">Parent-Child Relations (JSON)</label>
                                <textarea class="form-control" id="joinRelations" rows="3" placeholder='{"parent": ["child1", "child2"]}'></textarea>
                                <div class="form-text">Define parent-child relationships as JSON object</div>
                            </div>

                            <div class="form-check mb-3" id="docValues">

                            </div>

                            <div class="form-check mb-3" id="indexField">

                            </div>

                            <div class="form-check mb-3" id="storeField">

                            </div>
                            <div class="form-check mb-3" id="isNested">

                            </div>
                            <div class="mb-3" id="parentFieldGroup" style="display: none;">
                                <label for="parentFieldv1" class="form-label">Parent Field</label>
                                <select class="form-select" id="parentFieldv1">
                                    <option value="">Select parent field...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="fieldProperties" class="form-label">Additional Properties (JSON)</label>
                                <textarea class="form-control" id="fieldProperties" rows="3" placeholder='{"analyzer": "standard", "index": true}'></textarea>
                            </div>
                        </form>
                    </div>

                    <!-- Nested Fields Management -->
                    <div class="col-md-6">
                        <h6 class="text-success mb-3"><i class="fas fa-sitemap me-2"></i>Nested Fields & Sub-fields</h6>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small class="text-muted">Child fields within this object/nested field</small>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-sm btn-outline-success" id="addNestedField">
                                        <i class="fas fa-plus me-1"></i>Add Field
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary" id="dragExistingField">
                                        <i class="fas fa-arrows-alt me-1"></i>Drag From Above
                                    </button>
                                </div>
                            </div>
                            <div id="nestedFieldsList" class="border rounded p-2 nested-drop-zone" style="min-height: 200px; max-height: 300px; overflow-y: auto;">
                                <div class="text-muted text-center py-3" id="noNestedFields">
                                    <i class="fas fa-info-circle me-2"></i>No nested fields added yet
                                    <br><small>Add fields manually or drag from mapping builder</small>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Add Common Fields -->
                        <div class="mb-3">
                            <label class="form-label small">Quick Add Common Fields:</label>
                            <div class="btn-group-vertical w-100" role="group">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addQuickNestedField('id', 'keyword')">
                                    <i class="fas fa-key me-1"></i>ID (keyword)
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addQuickNestedField('name', 'text')">
                                    <i class="fas fa-tag me-1"></i>Name (text)
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addQuickNestedField('timestamp', 'date')">
                                    <i class="fas fa-clock me-1"></i>Timestamp (date)
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-info" onclick="addQuickNestedField('score', 'float')">
                                    <i class="fas fa-star me-1"></i>Score (float)
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-warning" onclick="addQuickNestedField('active', 'boolean')">
                                    <i class="fas fa-toggle-on me-1"></i>Active (boolean)
                                </button>
                            </div>
                        </div>

                        <!-- Available Fields for Dragging -->
                        <div class="mb-3" id="availableFieldsForDrag" style="display: none;">
                            <label class="form-label small">Available Fields to Drag:</label>
                            <div id="availableFieldsList" class="border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveFieldConfig">
                    <i class="fas fa-save me-2"></i>Save Configuration
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add Nested Field Modal -->
<div class="modal fade" id="addNestedFieldModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Nested Field</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="nestedFieldForm">
                    <div class="mb-3">
                        <label for="nestedFieldName" class="form-label">Field Name</label>
                        <input type="text" class="form-control" id="nestedFieldName" placeholder="Enter field name" required>
                    </div>
                    <div class="mb-3">
                        <label for="nestedFieldType" class="form-label">Field Type</label>
                        <select class="form-select" id="nestedFieldType" required>
                            <option value="">Select type...</option>
                            <option value="text">Text</option>
                            <option value="keyword">Keyword</option>
                            <option value="long">Long</option>
                            <option value="integer">Integer</option>
                            <option value="double">Double</option>
                            <option value="float">Float</option>
                            <option value="date">Date</option>
                            <option value="boolean">Boolean</option>
                            <option value="object">Object</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="nestedFieldProperties" class="form-label">Properties (JSON)</label>
                        <textarea class="form-control" id="nestedFieldProperties" rows="3" placeholder='{"index": true, "analyzer": "standard"}'></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveNestedField">Add Field</button>
            </div>
        </div>
    </div>
</div>

<!-- Parent-Child Configuration Modal -->
<div class="modal fade" id="parentChildModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Configure Parent-Child Relationship</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Relationship Name</label>
                    <input type="text" class="form-control" id="relationshipName" placeholder="e.g., question_answer">
                </div>
                <div class="mb-3">
                    <label class="form-label">Parent Type</label>
                    <input type="text" class="form-control" id="parentType" placeholder="e.g., question">
                </div>
                <div class="mb-3">
                    <label class="form-label">Child Type</label>
                    <input type="text" class="form-control" id="childType" placeholder="e.g., answer">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveParentChildRelation()">Create Relationship</button>
            </div>
</div>
</div>
</div>
<!-- Update Mapping Modal -->
<div class="modal fade" id="updateMappingModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Update Mapping</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Elasticsearch Environment</label>
                    <select id="updateEnvSelect" class="form-select"></select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Index</label>
                    <select id="updateIndexSelect" class="form-select"></select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Root Fields</label>
                    <select id="updateRootFields" class="form-select" multiple></select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Parent-Child Fields</label>
                    <select id="updateParentChildFields" class="form-select" multiple></select>
                </div>
                <div class="mb-3" id="updateRelationsGroup" style="display:none;">
                    <label class="form-label">Parent-Child Relations</label>
                    <select id="updateRelations" class="form-select"></select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Nested Fields</label>
                    <select id="updateNestedFields" class="form-select" multiple></select>
                </div>
                <div class="mb-3">
                    <label class="form-label">AI Fields</label>
                    <select id="updateAIFields" class="form-select" multiple></select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="saveMappingUpdate()">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Saved Mappings Modal -->
<div class="modal fade" id="savedMappingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-save me-2"></i>Saved Mappings Management
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="savedMappingsList1">
                    <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin fa-3x mb-3"></i>
                        <p>Loading saved mappings...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="refreshSavedMappings()">
                    <i class="fas fa-sync me-1"></i>Refresh
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Custom Analyzer Modal -->
<div class="modal fade" id="customAnalyzerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Custom Analyzer</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="customAnalyzerName" class="form-label">Analyzer Name</label>
                    <input type="text" class="form-control" id="customAnalyzerName" placeholder="my_analyzer">
                </div>
                <div class="mb-3">
                    <label for="customTokenizer" class="form-label">Tokenizer</label>
                    <select class="form-select" id="customTokenizer">
                        <option value="">Select tokenizer...</option>
                        <option value="standard">standard</option>
                        <option value="letter">letter</option>
                        <option value="lowercase">lowercase</option>
                        <option value="whitespace">whitespace</option>
                        <option value="uax_url_email">uax_url_email</option>
                        <option value="ngram">ngram</option>
                        <option value="edge_ngram">edge_ngram</option>
                        <option value="keyword">keyword</option>
                        <option value="pattern">pattern</option>
                        <option value="path_hierarchy">path_hierarchy</option>
                        <option value="thai">thai</option>
                        <option value="kuromoji_tokenizer">kuromoji_tokenizer</option>
                        <option value="nori_tokenizer">nori_tokenizer</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Token Filters</label>
                    <div id="customTokenFilters" class="d-flex flex-wrap">
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="lowercase" id="filter-lowercase">
                            <label class="form-check-label" for="filter-lowercase">lowercase</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="uppercase" id="filter-uppercase">
                            <label class="form-check-label" for="filter-uppercase">uppercase</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="length" id="filter-length">
                            <label class="form-check-label" for="filter-length">length</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="truncate" id="filter-truncate">
                            <label class="form-check-label" for="filter-truncate">truncate</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="stop" id="filter-stop">
                            <label class="form-check-label" for="filter-stop">stop</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="stemmer" id="filter-stemmer">
                            <label class="form-check-label" for="filter-stemmer">stemmer</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="porter_stem" id="filter-porter_stem">
                            <label class="form-check-label" for="filter-porter_stem">porter_stem</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="snowball" id="filter-snowball">
                            <label class="form-check-label" for="filter-snowball">snowball</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="edge_ngram" id="filter-edge_ngram">
                            <label class="form-check-label" for="filter-edge_ngram">edge_ngram</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="ngram" id="filter-ngram">
                            <label class="form-check-label" for="filter-ngram">ngram</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="synonym" id="filter-synonym">
                            <label class="form-check-label" for="filter-synonym">synonym</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="reverse" id="filter-reverse">
                            <label class="form-check-label" for="filter-reverse">reverse</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="unique" id="filter-unique">
                            <label class="form-check-label" for="filter-unique">unique</label>
                        </div>
                        <div class="form-check me-3">
                            <input class="form-check-input" type="checkbox" value="shingle" id="filter-shingle">
                            <label class="form-check-label" for="filter-shingle">shingle</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveCustomAnalyzer()">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Vector Embedding Modal -->
<div class="modal fade" id="vectorEmbeddingModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Vector Embedding</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="vectorFieldName" class="form-label">Field Name</label>
                    <input type="text" class="form-control" id="vectorFieldName" placeholder="title_small">
                </div>
                <div class="mb-3">
                    <label for="vectorFieldType" class="form-label">Vector Type</label>
                    <select class="form-select" id="vectorFieldType">
                        <option value="dense_vector">dense_vector</option>
                        <option value="dense_vector_index_true">dense_vector with index: true</option>
                        <option value="dense_vector_index_false">dense_vector with index: false</option>
                        <option value="sparse_vector">sparse_vector</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="vectorFieldDims" class="form-label">Vector Dimensions</label>
                    <input type="number" class="form-control" id="vectorFieldDims" value="384" min="1">
                </div>
                <div class="mb-3">
                    <label for="vectorFieldSimilarity" class="form-label">Similarity</label>
                    <select class="form-select" id="vectorFieldSimilarity">
                        <option value="cosine">cosine</option>
                        <option value="dot_product">dot_product</option>
                        <option value="l2_norm">l2_norm</option>
                        <option value="max_inner_product">max_inner_product</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveVectorFieldBtn" onclick="saveVectorField()">Add</button>
            </div>
        </div>
    </div>
</div>

<!-- Save to Elasticsearch Modal -->
<div class="modal fade" id="saveToElasticsearchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-save me-2 text-success"></i>Save Mapping to Elasticsearch
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="saveToElasticsearchForm">
                    <div class="mb-3">
                        <label for="elasticsearchEnvironment" class="form-label">Elasticsearch Environment</label>
                        <select class="form-select" id="elasticsearchEnvironment" required>
                            <option value="">Select environment...</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="newIndexName" class="form-label">Index Name</label>
                        <input type="text" class="form-control" id="newIndexName" required
                               placeholder="Enter index name (e.g., my-new-index)">
                        <div class="form-text">Index names must be lowercase and can contain letters, numbers, hyphens, and underscores</div>
                    </div>
                    <div class="mb-3">
                        <label for="mappingNameForSave" class="form-label">Mapping Name</label>
                        <input type="text" class="form-control" id="mappingNameForSave" required
                               placeholder="Enter mapping name for reference">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Mapping Preview</label>
                        <div class="border rounded p-3 bg-light">
                            <pre id="mappingPreviewForSave" class="mb-0 small" style="max-height: 200px; overflow-y: auto;"></pre>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" onclick="saveToElasticsearch()">
                    <i class="fas fa-save me-1"></i>Save to Elasticsearch
                </button>
            </div>
        </div>
    </div>


</div>

<script src="/static/js/bootstrap.bundle.min.js"></script>
<script src="/static/js/Sortable.min.js"></script>
<script src="/static/app.js"></script>
<script src="/static/enhanced-indices-manager.js"></script>
<script>
    // Modern UI Enhancements
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize modern tab functionality
        initializeModernTabs();

        // Add loading states for better UX
        initializeLoadingStates();

        // Initialize form validation
        initializeFormValidation();
    });

    function initializeModernTabs() {
        // Handle form builder sub-tabs
        const formBuilderTabs = document.querySelectorAll('#formBuilderTabs .nav-link');
        formBuilderTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Update active states
                formBuilderTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Add smooth scrolling for better UX
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    }

    function initializeLoadingStates() {
        // Enhanced loading states for buttons
        const buttons = document.querySelectorAll('.btn-primary-custom, .btn-success-custom');
        buttons.forEach(button => {
            button.addEventListener('click', function() {
                if (!this.disabled) {
                    const spinner = document.createElement('div');
                    spinner.className = 'loading-spinner me-2';
                    spinner.style.display = 'inline-block';
                    this.prepend(spinner);

                    setTimeout(() => {
                        spinner.remove();
                    }, 2000);
                }
            });
        });
    }

    function initializeFormValidation() {
        // Real-time form validation
        const formEnvironment = document.getElementById('formEnvironment');
        const formIndex = document.getElementById('formIndex');
        const loadFieldsBtn = document.getElementById('loadIndexFields');

        if (formEnvironment) {
            formEnvironment.addEventListener('change', function() {
                if (this.value) {
                    formIndex.disabled = false;
                    formIndex.classList.remove('opacity-50');
                } else {
                    formIndex.disabled = true;
                    formIndex.classList.add('opacity-50');
                    loadFieldsBtn.disabled = true;
                }
            });
        }

        if (formIndex) {
            formIndex.addEventListener('change', function() {
                if (this.value) {
                    loadFieldsBtn.disabled = false;
                    loadFieldsBtn.classList.remove('opacity-50');
                } else {
                    loadFieldsBtn.disabled = true;
                    loadFieldsBtn.classList.add('opacity-50');
                }
            });
        }
    }

    // Enhanced hover effects
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.demo-card');
        cards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px)';
            });

            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(-5px)';
            });
        });
    });
</script>

<div class="modal fade" id="operatorModal" tabindex="-1" aria-labelledby="operatorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="operatorModalLabel">
                    <i class="fas fa-cogs me-2"></i>Select Logical Operator
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">Choose the logical operator for this checkbox field:</p>

                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-outline-primary btn-lg" onclick="selectOperator('AND')">
                        <i class="fas fa-plus-circle me-2"></i>
                        <strong>AND</strong>
                        <br>
                        <small class="text-muted">All conditions must be true</small>
                    </button>

                    <button type="button" class="btn btn-outline-warning btn-lg" onclick="selectOperator('OR')">
                        <i class="fas fa-circle-dot me-2"></i>
                        <strong>OR</strong>
                        <br>
                        <small class="text-muted">At least one condition must be true</small>
                    </button>

                    <button type="button" class="btn btn-outline-danger btn-lg" onclick="selectOperator('NOT')">
                        <i class="fas fa-times-circle me-2"></i>
                        <strong>NOT</strong>
                        <br>
                        <small class="text-muted">Exclude this condition</small>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Multi-Value Checkbox Modal -->
<div class="modal fade" id="multiValueModal" tabindex="-1" aria-labelledby="multiValueModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="multiValueModalLabel">
                    <i class="fas fa-list-check me-2"></i>Select Multiple Values
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Operator Selection -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="multiValueOperator" class="form-label">
                            <i class="fas fa-cogs me-2"></i>Logical Operator
                        </label>
                        <select class="form-select" id="multiValueOperator">
                            <option value="AND">AND - All selected values must match</option>
                            <option value="OR">OR - Any selected value can match</option>
                            <option value="NOT">NOT - Exclude selected values</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Selection Status</label>
                        <div class="form-control-plaintext">
                            <span id="multiValueCounter" class="badge bg-secondary">0 of 0 selected</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="row mb-3">
                    <div class="col-12">
                        <button type="button" class="btn btn-sm btn-outline-primary me-2" onclick="selectAllMultiValues()">
                            <i class="fas fa-check-double me-1"></i>Select All
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary me-2" onclick="deselectAllMultiValues()">
                            <i class="fas fa-times me-1"></i>Deselect All
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-warning" onclick="clearMultiValueSelection()">
                            <i class="fas fa-trash me-1"></i>Clear Selection
                        </button>
                    </div>
                </div>

                <!-- Available Values -->
                <div class="row">
                    <div class="col-12">
                        <label class="form-label">
                            <i class="fas fa-list me-2"></i>Available Values
                        </label>
                        <div class="border rounded p-3" style="max-height: 300px; overflow-y: auto;">
                            <div id="multiValueOptions">
                                <!-- Dynamic options will be loaded here -->
                                <div class="text-center text-muted">
                                    <i class="fas fa-spinner fa-spin me-2"></i>Loading options...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="applyMultiValueSelection()">
                    <i class="fas fa-check me-2"></i>Apply Selection
                </button>
            </div>
        </div>
    </div>
</div>

</body>
<!-- INSERT AFTER LINE 2400: Enhanced Field Configuration Modal -->
<div class="modal fade" id="enhancedFieldConfigModal" tabindex="-1" aria-labelledby="enhancedFieldConfigLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="enhancedFieldConfigLabel">
                    <i class="fas fa-cogs me-2"></i>Configure Form Field
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="enhancedFieldConfigForm">
                    <!-- Field Label Configuration -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="fieldLabel" class="form-label">
                                <i class="fas fa-tag me-2"></i>Field Label
                            </label>
                            <input type="text" class="form-control" id="fieldLabel" placeholder="Enter display label">
                        </div>
                        <div class="col-md-6">
                            <label for="fieldInputType" class="form-label">
                                <i class="fas fa-keyboard me-2"></i>Input Type
                            </label>
                            <select class="form-select" id="fieldInputType" onchange="handleInputTypeChange()">
                                <option value="text">Text Input</option>
                                <option value="number">Number Input</option>
                                <option value="number-range">Number Range</option>
                                <option value="date">Date Input</option>
                                <option value="date-range">Date Range</option>
                                <option value="dropdown">Dropdown Select</option>
                            <option value="checkbox">Multi-Select Checkbox</option>
                            <option value="radio">Radio Buttons</option>
                            </select>
                        </div>
                    </div>

                    <!-- Operator Selection -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="fieldOperator" class="form-label">
                                <i class="fas fa-balance-scale me-2"></i>Operator
                            </label>
                            <select class="form-select" id="fieldOperator"></select>
                        </div>
                    </div>

                    <!-- Source Configuration -->
                    <div id="sourceConfigSection" style="display: none;">
                        <div class="source-config-section">
                            <h6 class="mb-3">
                                <i class="fas fa-database me-2"></i>Source Configuration
                            </h6>

                            <!-- Index Selection -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="sourceIndexSelect" class="form-label">Source Index</label>
                                    <select class="form-select" id="sourceIndexSelect" onchange="loadSourceIndexMapping()">
                                        <option value="">Select index...</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="keyFieldSelect" class="form-label">Key Field</label>
                                    <select class="form-select" id="keyFieldSelect">
                                        <option value="">Select key field...</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="valueFieldSelect" class="form-label">Value Field</label>
                                    <select class="form-select" id="valueFieldSelect">
                                        <option value="">Select value field...</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Mapping Fields Preview -->
                            <div class="mb-3">
                                <label class="form-label">Available Mapping Fields</label>
                                <div id="mappingFieldsList" class="mapping-field-list">
                                    <p class="text-muted">Select an index to view mapping fields</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Field Options -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="fieldRequired">
                                <label class="form-check-label" for="fieldRequired">
                                    Required Field
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="fieldPlaceholder" class="form-label">Placeholder Text</label>
                            <input type="text" class="form-control" id="fieldPlaceholder" placeholder="Enter placeholder text">
                        </div>
                    </div>

                    <!-- Field Role -->
                    <div class="mb-3">
                        <label for="fieldRole" class="form-label">
                            <i class="fas fa-user-tag me-2"></i>Field Role
                        </label>
                        <select class="form-select" id="fieldRole">
                            <option value="value">Value Field (for search/filter)</option>
                            <option value="key">Key Field (identifier)</option>
                            <option value="display">Display Field (read-only)</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="saveEnhancedFieldConfig()">
                    <i class="fas fa-save me-2"></i>Save Configuration
                </button>
            </div>
        </div>
    </div>
</div>

<!-- INSERT AFTER ENHANCED FIELD CONFIG MODAL: Enhanced Multi-Value Selection Modal -->
<div class="modal fade" id="enhancedMultiValueModal" tabindex="-1" aria-labelledby="enhancedMultiValueLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="enhancedMultiValueLabel">
                    <i class="fas fa-list-check me-2"></i>Configure Multi-Value Selection
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Operator Selection -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <label class="form-label fw-bold">
                            <i class="fas fa-code-branch me-2"></i>Logical Operator
                        </label>
                        <div class="btn-group w-100" role="group" id="operatorButtonGroup">
                            <input type="radio" class="btn-check" name="logicalOperator" id="operatorAND" value="AND" checked>
                            <label class="btn btn-outline-success" for="operatorAND">
                                <i class="fas fa-plus-circle me-2"></i>AND
                                <br><small>All selected must match</small>
                            </label>

                            <input type="radio" class="btn-check" name="logicalOperator" id="operatorOR" value="OR">
                            <label class="btn btn-outline-warning" for="operatorOR">
                                <i class="fas fa-circle-dot me-2"></i>OR
                                <br><small>Any selected can match</small>
                            </label>

                            <input type="radio" class="btn-check" name="logicalOperator" id="operatorNOT" value="NOT">
                            <label class="btn btn-outline-danger" for="operatorNOT">
                                <i class="fas fa-times-circle me-2"></i>NOT
                                <br><small>Exclude selected values</small>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Selection Controls -->
                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="selectAllValues()">
                                <i class="fas fa-check-double me-1"></i>Select All
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="deselectAllValues()">
                                <i class="fas fa-times me-1"></i>Deselect All
                            </button>
                            <button type="button" class="btn btn-outline-info btn-sm" onclick="invertSelection()">
                                <i class="fas fa-exchange-alt me-1"></i>Invert Selection
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <span id="selectionCounter" class="badge bg-primary fs-6">0 of 0 selected</span>
                    </div>
                </div>

                <!-- Search Filter -->
                <div class="mb-3">
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="fas fa-search"></i>
                        </span>
                        <input type="text" class="form-control" id="valueSearchFilter"
                               placeholder="Search values..." onkeyup="filterValues()">
                    </div>
                </div>

                <!-- Values Selection Grid -->
                <div class="row">
                    <div class="col-12">
                        <label class="form-label fw-bold">Available Values</label>
                        <div id="valuesSelectionGrid" class="values-selection-grid">
                            <!-- Dynamic values will be loaded here -->
                            <div class="text-center text-muted p-4">
                                <i class="fas fa-spinner fa-spin me-2"></i>Loading values...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Selection Summary -->
                <div id="selectionSummary" class="selection-summary mt-3" style="display: none;">
                    <h6><i class="fas fa-info-circle me-2"></i>Selection Summary</h6>
                    <div id="summaryContent"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-success" onclick="applyEnhancedSelection()">
                    <i class="fas fa-check me-2"></i>Apply Selection
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Logical Operator Configuration Modal -->
<div class="modal fade" id="logicalOperatorModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-code-branch me-2"></i>Configure Field Logical Relationship
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Current Field Configuration</h6>
                        <div id="currentFieldsPreview" class="border rounded p-3 mb-3" style="max-height: 200px; overflow-y: auto;">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Logical Operator Options</h6>
                        <div class="d-grid gap-2">
                            <button type="button" class="btn btn-outline-success operator-btn" data-operator="AND">
                                <i class="fas fa-plus-circle me-2"></i>
                                <strong>AND</strong> - All conditions must be true
                                <br><small class="text-muted">Field1 AND Field2 AND Field3</small>
                            </button>
                            <button type="button" class="btn btn-outline-warning operator-btn" data-operator="OR">
                                <i class="fas fa-circle-dot me-2"></i>
                                <strong>OR</strong> - Any condition can be true
                                <br><small class="text-muted">Field1 OR Field2 OR Field3</small>
                            </button>
                            <button type="button" class="btn btn-outline-danger operator-btn" data-operator="NOT">
                                <i class="fas fa-times-circle me-2"></i>
                                <strong>NOT</strong> - Exclude this condition
                                <br><small class="text-muted">Field1 AND NOT Field2</small>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <h6>Advanced Grouping</h6>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="enableGrouping">
                        <label class="form-check-label" for="enableGrouping">
                            Enable field grouping with parentheses
                        </label>
                    </div>
                    <small class="text-muted">
                        Example: (Field1 AND Field2) OR (Field3 AND Field4)
                    </small>
                </div>

                <div class="mt-3">
                    <label class="form-label">Preview Query Logic</label>
                    <div id="queryLogicPreview" class="alert alert-light border">
                        <code id="queryLogicText">Select fields and operators to see query preview</code>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="applyLogicalOperators()">
                    <i class="fas fa-check me-2"></i>Apply Logic
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="validationModal" tabindex="-1" aria-labelledby="validationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="validationModalLabel">Mapping Validation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="validationModalBody">
                <!-- Will be filled dynamically -->
            </div>
        </div>
    </div>
</div>





<!--  ADD THESE NEW MODALS -->

<!-- Auto-Detection Results Modal -->
<div class="modal fade" id="autoDetectionModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-magic me-2"></i>Auto-Detection Results
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="detectionResults">
                    <!-- Results will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" onclick="applyDetectionResults()">
                    <i class="fas fa-check me-2"></i>Apply Results
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Relationship Configuration Modal -->
<div class="modal fade" id="relationshipModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-link me-2"></i>Configure Relationship
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="relationshipForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="parentTable" class="form-label">Parent Table</label>
                                <select id="parentTable" class="form-select" required>
                                    <option value="">Select parent table...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="parentField" class="form-label">Parent Field</label>
                                <select id="parentField" class="form-select" required>
                                    <option value="">Select parent field...</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="childTable" class="form-label">Child Table</label>
                                <select id="childTable" class="form-select" required>
                                    <option value="">Select child table...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="childField" class="form-label">Child Field</label>
                                <select id="childField" class="form-select" required>
                                    <option value="">Select child field...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Relationship Type</label>
                        <div class="relationship-type-selector">
                            <span class="relationship-type-option selected" data-type="nested">
                                <i class="fas fa-layer-group me-2"></i>Nested Object
                            </span>
                            <span class="relationship-type-option" data-type="join">
                                <i class="fas fa-link me-2"></i>Parent-Child Join
                            </span>
                            <span class="relationship-type-option" data-type="object">
                                <i class="fas fa-cube me-2"></i>Object
                            </span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveRelationship()">
                    <i class="fas fa-save me-2"></i>Save Relationship
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Field Type Edit Modal -->
<div class="modal fade" id="fieldTypeModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="fieldTypeModalLabel">Edit Field Type</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="fieldTypeSelect" class="form-label">Elasticsearch Type</label>
          <select id="fieldTypeSelect" class="form-select">
            <option value="text">text</option>
            <option value="keyword">keyword</option>
            <option value="long">long</option>
            <option value="integer">integer</option>
            <option value="short">short</option>
            <option value="float">float</option>
            <option value="double">double</option>
            <option value="date">date</option>
            <option value="boolean">boolean</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="updateFieldType()">Update</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>